<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.line {
  fill: none;
  stroke-width: 1.5px;
}

.tooltip .circle{
  fill: none;
}
</style>
<body>
  <div id="line-1"></div>
  <div id="bar-1"></div>

<script src="http://d3js.org/d3.v3.js"></script>
<script src="d3.line.js"></script>
<script src="d3.bar.js"></script>

<script>

// Method used for generate random data.
var getData = function(myRand){
  var data = [];
  
  for(var i=0; i<100; i++){
  	var point = Math.round(myRand());
  	if(point > 100){
  		point = 100;
  	}else if(point < 0){
  		point = 0;
  	}
    data.push({
      x: i,
      y: point
    });
  };

  return data;
};

var sinData = function(){
	var data = [];
	var counter = 0;
	var days = 8;
	var base = 50;
	var growth = 70;
	var noise = d3.random.normal(5, 5);
	
	var increase = Math.PI * 2 / 96;
	var increment = 0;

	for ( i = 0; i <= days; i += 0.01 ) {
		var point = (Math.sin( counter ) / 2 + 0.5) * (base + (growth/days * Math.round(i))) + noise();

		if(point > 100){
	  	point = 100;
		}else if(point < 0){
	  	point = 0;
	  }
	  data.push({
	  	x: increment,
	  	y: point
	  });
	  counter += increase;
	  increment++;
	};

	return data;
};

var bandIt = function(data){
	var bands = d3.scale.threshold()
		.domain([50, 70, 90])
		.range(['Low', 'Medium', 'High', 'Critical']);

	var summary = []; //{ Low: 0, Medium: 0, High: 0, Critical: 0 };
	// initialize summary
	summary.push({ name: "Low", value: 0 });
	summary.push({ name: "Medium", value: 0 });
	summary.push({ name: "High", value: 0 });
	summary.push({ name: "Critical", value: 0 });

	for(var i = 0; i < data.length; i++){
		var band = bands(data[i].y);
		for(var j = 0; j < summary.length; j++){
			if(band == summary[j].name){
				summary[j].value++
			}
		}
	}
	return summary;
};

/*
* Create graphs
*/
var data = sinData();

var line = line()
              .$el(d3.select("#line-1"))
              .height(200) // Set height
              .width(1000)
              .data(data) // Set data
              .render();

var bar = bar()
	.$el(d3.select("#bar-1"))
	.data(bandIt(data))
	.color(["green", "blue", "yellow", "red"])
	.labelColor(["black", "white", "black", "black"])
	.render();

/*
* Refresh graphs repeatedly
*/
setInterval(function(){
	var data = sinData();
	line.data(data).render();
	bar.data(bandIt(data)).render();
}, 3000);
</script>
